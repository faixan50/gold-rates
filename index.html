<script>
async function loadRates() {
  try {
    // gold price in USD/oz from metals.live through a CORS proxy
    const proxy = "https://api.allorigins.win/get?url=";
    const goldURL = encodeURIComponent("https://api.metals.live/v1/spot/gold");
    const goldResp = await fetch(proxy + goldURL);
    const goldData = JSON.parse((await goldResp.json()).contents);
    const usdPerOunce = goldData[0].price;

    // USD→OMR rate
    const fxResp = await fetch("https://api.exchangerate.host/latest?base=USD&symbols=OMR");
    const fxData = await fxResp.json();
    const usdToOmr = fxData.rates.OMR;

    const omrPerGram24 = (usdPerOunce / 31.1035) * usdToOmr;
    const rates = {
      "24K": omrPerGram24,
      "21K": omrPerGram24 * 0.875,
      "18K": omrPerGram24 * 0.75
    };

    for (const [karat, value] of Object.entries(rates)) {
      document.getElementById(`k${karat.slice(1)}`).textContent = value.toFixed(3);
    }
    document.getElementById("time").textContent =
      "Last updated: " + new Date().toLocaleTimeString();
  } catch (err) {
    document.getElementById("time").textContent = "⚠️ Error fetching rates";
    console.error(err);
  }
}
loadRates();
setInterval(loadRates, 60000);
</script>
