<script>
async function loadRates() {
  try {
    // Fetch gold price in OMR per troy ounce using exchangerate.host
    const res = await fetch("https://api.exchangerate.host/latest?base=XAU&symbols=OMR");
    const data = await res.json();
    const omrPerOunce = data.rates.OMR;
    if (!omrPerOunce) throw new Error("Invalid response");

    // Convert ounce to gram
    const gramsPerOunce = 31.1035;
    const omrPerGram24 = omrPerOunce / gramsPerOunce;

    // Calculate 21K and 18K
    const rates = {
      "24K": omrPerGram24,
      "21K": omrPerGram24 * 0.875,
      "18K": omrPerGram24 * 0.75
    };

    // Display prices
    for (const [karat, price] of Object.entries(rates)) {
      document.getElementById(`k${karat.slice(1)}`).textContent = price.toFixed(3);
    }

    // Show update time
    document.getElementById("time").textContent =
      "Last updated: " + new Date().toLocaleTimeString();
  } catch (err) {
    console.error(err);
    document.getElementById("time").textContent = "⚠️ Error loading rates";
  }
}

// Load now + refresh every minute
loadRates();
setInterval(loadRates, 60000);
</script>
